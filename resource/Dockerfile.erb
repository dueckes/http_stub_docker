# Generated by http_stub_docker, edit at your peril
FROM ruby:2.4.2-alpine

# Install bundle dependencies
RUN apk add --update build-base libffi-dev

# Install Bundler
RUN gem install bundler

# For efficiency, cache Gems as these change less frequently than the Stubs configuration
COPY Gemfile Gemfile.lock *.gemspec /root/app/
WORKDIR /root/app
RUN bundle install --without development

# Copy code
COPY . /root/app/

# Expose server port
EXPOSE <%= port %>

# Start server & tail logs in order to sustain foreground process
CMD trap exit TERM; bundle exec rake stub_server:start && tail -f tmp/log/stub_server_console.log
